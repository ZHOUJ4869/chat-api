<!-- src/main/resources/mapper/AgentUserRapportMapper.xml -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jz.ai.mapper.AgentUserRapportMapper">

    <insert id="upsertBatch">
        INSERT INTO agent_user_rapport
        (agent_id, user_id, score, turns, since_last_reco, last_interaction_at)
        VALUES
        <foreach collection="list" item="e" separator=",">
            (#{e.agentId}, #{e.userId}, #{e.score}, #{e.turns}, #{e.sinceLastReco}, #{e.lastInteractionAt})
        </foreach>
        ON DUPLICATE KEY UPDATE
        score = VALUES(score),
        turns = VALUES(turns),
        since_last_reco = VALUES(since_last_reco),
        last_interaction_at = VALUES(last_interaction_at)
    </insert>

</mapper>
